<h3>1. PrÃ©sentation</h3>
<p>
    <b>header()</b> permet de modifier les entÃªtes HTTP d'une page. Elle est souvent utilisÃ©e pour rediriger l'utilisateur vers une autre page. 
</p>

<h3>2. Syntaxe</h3>
<textarea class="code-php">
    header(string $header, bool $replace = true, int $response_code = 0);
</textarea>
<ul class="mt-3">
    <li><b>$header</b> : L'en-tÃªte HTTP Ã  envoyer. Cela peut inclure des directives comme le type de contenu, les redirections ou les cookies.</li>
    <li><b>$replace</b> (facultatif) : DÃ©finit si une en-tÃªte existante doit Ãªtre remplacÃ©e. Par dÃ©faut, cette valeur est true.</li>
    <li><b>$response_code</b> (facultatif) : Le code de statut HTTP Ã  envoyer (par exemple, 200, 404, 301).</li>
</ul>

<h3>3. Utilisations courantes de header()</h3>

<h4>1. Les Redirections</h4>
<p>Avec le paramÃ¨tre "<b>Location:</b>" suivi de l'url de redirection</p>
<textarea class="code-php">
    header("Location: https://www.google.be");
    exit; // Toujours utiliser `exit` aprÃ¨s une redirection pour arrÃªter le script.
</textarea>
<a class="btn btn-primary" href="tests/redir" target="_blank">ExÃ©cuter <b>tests/redir</b></a>

<p>
    Redirection aprÃ¨s x secondes avec le paramÃ¨tre "<b>Refresh:</b>" suivi du nombre de secondes et du paramÃ¨tre "<b>url=</b>" et l'url, avec un point-virgule entre les deux.
</p> 
<textarea class="code-php">        
    header("Refresh: 2; url=https://www.example.com");
    echo "Vous allez Ãªtre redirigÃ© vers \"www.example.com\" dans 2 secondes.";
    exit;
</textarea>
<a class="btn btn-primary" href="tests/redir2" target="_blank">ExÃ©cuter <b>tests/redir2</b></a>

<h4>2. DÃ©finir le type de contenu</h4>
<textarea class="code-php">
    header("Content-Type: application/json");
    echo json_encode(["message" => "Bonjour, monde!"]);
</textarea>
<a class="btn btn-primary" href="tests/typecontenu" target="_blank">ExÃ©cuter <b>tests/typecontenu</b></a>


<h4>3. Forcer le tÃ©lÃ©chargement dâ€™un fichier</h4>
<textarea class="code-php">
    header("Content-Disposition: attachment; filename=\"document.pdf\"");
    header("Content-Type: application/pdf");
    readfile("sample.pdf");    
</textarea>
<a class="btn btn-primary" href="tests/file" target="_blank">ExÃ©cuter <b>tests/file</b></a>


<h4>4. ContrÃ´le du cache</h4>
<textarea class="code-php">
    header("Cache-Control: no-cache, no-store, must-revalidate"); // HTTP 1.1
    header("Pragma: no-cache"); // HTTP 1.0
    header("Expires: 0"); // EmpÃªche la mise en cache
</textarea>    
<a class="btn btn-primary" href="tests/cache" target="_blank">ExÃ©cuter <b>tests/cache</b></a>


<h4>5. Envoyer un code de statut HTTP personnalisÃ©</h4>
<textarea class="code-php">
    header("HTTP/1.1 404 Not Found");
    echo "Erreur 404 : Page non trouvÃ©e.";
</textarea>
<a class="btn btn-primary" href="tests/status" target="_blank">ExÃ©cuter <b>tests/status</b></a>

<h3>4. Points importants</h3>

<h4>1. Les en-tÃªtes doivent Ãªtre envoyÃ©s avant tout contenu HTML ou texte.</h4>
<p>
    Si vous essayez dâ€™envoyer un en-tÃªte aprÃ¨s que du contenu ait Ã©tÃ© envoyÃ©, PHP dÃ©clenchera une erreur de type :
    <b class="red">Cannot modify header information</b>
</p>

<p><b>Exemple problÃ©matique</b> :</p>
<textarea class="code-php">
    echo "Affichage d'un texte avant l'envoi d'un header (et donc envoi d'un header)<br>";
    header("Location: https://www.google.be"); // Cela provoquera une erreur.   
</textarea>
<a class="btn btn-primary" href="tests/before" target="_blank">ExÃ©cuter <b>tests/before</b></a>
<b>Remarque</b> Si le paramÃ¨tre <b class="red">output_buffering = off</b> dans le fichier <b>php.ini</b>, dans le cas contraire l'erreur ne sera pas affichÃ©e.
    
<p>
    <b>PremiÃ¨re solution</b> : <br>
    Placer la fonction header() avant tout affichage de contenu.
</p>
<textarea class="code-php">
    // retourne un code 400
    header("HTTP/1.0 400 Bad Request");    
    echo "Erreur 400 - Mauvaise requÃªte"; // Cela fonctionnera
</textarea>
<a class="btn btn-primary" href="tests/soluce1" target="_blank">ExÃ©cuter <b>tests/soluce1</b></a>


<p>
    <b>Seconde solution</b> : <br>
    Utiliser la fonction <b>ob_start()</b> pour dÃ©marrer la temporisation de sortie. Cela permet de stocker le contenu dans un tampon avant de l'envoyer.
</p>
<textarea class="code-php">
    ob_start(); // DÃ©marre la temporisation de sortie
    echo "Affichage d'un texte avant l'envoi d'un header (et donc envoi d'un header)<br>";
    // Attendre 2 secondes pour bien montrer que le contenu est stockÃ© dans un tampon et pas affichÃ©
    sleep(2);
    header("Location: https://www.example.com"); // Cela fonctionnera
    ob_end_flush(); // Envoie le contenu du tampon de sortie et stop la temporisation de sortie   
</textarea>
<a class="btn btn-primary" href="tests/soluce2" target="_blank">ExÃ©cuter <b>tests/soluce2</b></a>


<p>
    <b>TroisiÃ¨me solution</b>: <br>
    Utiliser la fonction headers_sent() pour vÃ©rifier si les en-tÃªtes ont dÃ©jÃ  Ã©tÃ© envoyÃ©s.
</p>
<textarea class="code-php">
    // echo "Affichage d'un texte avant l'envoi d'un header (et donc envoi d'un header)<br>";
    // Si les en-tÃªtes n'ont pas encore Ã©tÃ© envoyÃ©s, on peut utiliser header()
    if (!headers_sent()) {
        header("Location: https://www.example.com");
        exit;
    } else {
        echo "Les en-tÃªtes ont dÃ©jÃ  Ã©tÃ© envoyÃ©s.";
    }
</textarea>
<a class="btn btn-primary" href="tests/soluce3" target="_blank">ExÃ©cuter <b>tests/soluce3</b></a>

<h4>2. Les en-tÃªtes HTTP sont sensibles Ã  la casse</h4>
<p>
    Les en-tÃªtes HTTP sont sensibles Ã  la casse. Par exemple, <b>Content-Type</b> est diffÃ©rent de <b>content-type</b>.
</p>

<h3>5. Un exemple complet</h3>
<textarea class="code-php">   
    // ContrÃ´le du cache
    header("Cache-Control: no-cache, no-store, must-revalidate");
    header("Pragma: no-cache");
    header("Expires: 0");
    
    // Redirection vers une page si nÃ©cessaire
    if (!isset($_GET['access'])) {
        header("Location: error.php");
        exit;
    }
    
    // DÃ©finir le type de contenu
    header("Content-Type: application/json");
    
    // Envoyer une rÃ©ponse JSON
    $response = [
        "status" => "success",
        "message" => "Bienvenue sur notre API"
    ];
    echo json_encode($response);
</textarea>
<a class="btn btn-primary" href="tests/complet" target="_blank">ExÃ©cuter <b>tests/complet</b></a>

<h3>6. RÃ©sumÃ©</h3>
<ul>
    <li>La fonction header() est un outil puissant pour gÃ©rer les en-tÃªtes HTTP.</li>
    <li>Elle est utilisÃ©e pour rediriger les utilisateurs, gÃ©rer le cache, dÃ©finir des types de contenu ou envoyer des codes de statut HTTP.</li>
    <li>Attention Ã  toujours appeler cette fonction avant dâ€™envoyer tout contenu au navigateur.</li>
</ul>
<p>
    Avec ces connaissances, vous pouvez mieux contrÃ´ler lâ€™interaction entre votre serveur PHP et le navigateur de lâ€™utilisateur. ğŸ˜Š
</p>